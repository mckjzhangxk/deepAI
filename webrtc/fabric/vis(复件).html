<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="js/vis-network.min.js" type="text/javascript"></script>
    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>
</head>

<body>
    <button onclick="editDrag()">编辑</button>

    <button onclick="addNode()">添加</button>
    <button onclick="updateNode()">修改</button>
    <button onclick="removeNode()">删除</button>

    <button onclick="addEdge()">添加Edge</button>
    <button onclick="updateEdge()">修改Edge</button>
    <button onclick="removeEdge()">删除Edge</button>
    <div id="mynetwork"></div>
</body>
<script>
    let fixed = false;
    function editDrag() {
        let a = nodes.get()
        fixed = !fixed
        a.forEach(o => {
            o.fixed = fixed;
            nodes.update(o)
        })
    }
    function addNode() {
        try {
            nodes.add({
                id: 'abc',
                label: '中位数',
            });
        } catch (err) {
            alert(err);
        }
    }
    function updateNode() {
        try {
            nodes.update({
                id: 'abc',
                label: '平均数',
            })
        } catch (error) {
            alert(error)
        }
    }
    function removeNode() {
        try {
            nodes.remove({
                id: 'abc',
            })
        } catch (error) {
            alert(error)
        }
    }

    function addEdge() {
        try {
            edges.add({
                id: 'test',
                from: 1,
                to: 'abc',
                label: '测试',
                arrows: "from",
                color: { color: "#ff0000", opacity: 0.3 }
            })
        } catch (error) {
            alert(error)
        }
    }
    function updateEdge() {
        try {
            edges.update({
                id: 'test',
                from: 1,
                to: 'abc',
                arrows: "to",
            })
        } catch (error) {
            alert(error)
        }
    }
    function removeEdge() {
        try {
            edges.remove({
                id: 'test',
            })
        } catch (error) {
            alert(error)
        }
    }
    var nodes = new vis.DataSet([
        { id: 1, label: "Node 1", value: 1, shape: "box", color: "#97C2FC", fixed: true },
        { id: 2, label: "Node 2", value: 2, shape: "circle", color: "#FFFF00", fixed: true },
        { id: 3, label: "Node 3", value: 3, shape: "diamond", color: "#FB7E81", fixed: true },
        { id: 4, label: "Node 4", value: 4 },
        { id: 5, label: "Node 5", value: 5 },
    ]);

    // create an array with edges
    var edges = new vis.DataSet([
        {
            from: 1, to: 3,
            arrows: "to"

        },
        { from: 1, to: 2 },
        { from: 2, to: 4 },
        { from: 2, to: 5 },
        { from: 3, to: 3 },
    ]);
    function getEdgesOfNode(from, to) {
        return edges.get().filter(function (edge) {
            return edge.from === from && edge.to === to;
        });
    }
    edges.on('*', function (e) {
        console.log({ e })
    })
    var container = document.getElementById("mynetwork");
    var data = {
        nodes: nodes,
        edges: edges,
    };
    var options = {
        nodes: {
            // shape: "dot",
            // scaling: {
            //     customScalingFunction: function (min, max, total, value) {
            //         return value / total;
            //     },
            //     min: 5,
            //     max: 150
            // }
        },
        edges: {
            // "smooth": {
            //     "type": "discrete"
            // }
        },
        interaction: { hover: true },
        manipulation: {
            enabled: true,
        },
        physics: {
            hierarchicalRepulsion: {
                nodeDistance: 300,
            },
        },

    };
    let network = new vis.Network(container, data, options);
    network.on("selectNode", function (params) {
        console.log("selectNode Event:", params);
    });
    network.on("selectEdge", function (params) {
        console.log("selectEdge Event:", params);

    });

    network.on("controlNodeDragEnd", function (params) {
        // console.log("controlNodeDragEnd Event:", params);
        let from = params.controlEdge.from
        let to = params.controlEdge.to

        if (from && to) {
            console.log(`${from},${to}`)
            console.log(getEdgesOfNode(from, to))
            let e = getEdgesOfNode(from, to)[0];
            e.arrows = "to"
            edges.update(e)

        }
    });
    network.enableEditMode()
</script>

</html>